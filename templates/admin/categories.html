{% extends "admin/base.html" %}

{% block page_title %}Категорії{% endblock %}

{% block content %}
<div x-data="categoriesApp()" x-init="loadCategories()">
    <!-- Header -->
    <div class="page-header">
        <button class="btn btn-primary" @click="openModal()">
            <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/></svg>
            Додати категорію
        </button>
    </div>

    <!-- Categories List -->
    <div class="card">
        <div class="table-wrapper">
            <table class="table" x-show="categories.length > 0">
                <thead>
                    <tr>
                        <th>Іконка</th>
                        <th>Назва</th>
                        <th>Порядок</th>
                        <th>Дії</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="cat in categories" :key="cat._id">
                        <tr>
                            <td>
                                <span class="cat-icon-preview" x-html="getIcon(cat.icon)"></span>
                            </td>
                            <td x-text="cat.name"></td>
                            <td x-text="cat.sort_order"></td>
                            <td>
                                <button class="btn-icon danger" @click="deleteCategory(cat._id)" title="Видалити">
                                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/></svg>
                                </button>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <div class="empty-state" x-show="categories.length === 0">
            <h3>Категорії відсутні</h3>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal" x-show="showModal" x-transition @click.self="showModal = false">
        <div class="modal-content modal-form">
            <div class="modal-header">
                <h3>Нова категорія</h3>
                <button @click="showModal = false">&times;</button>
            </div>
            <form @submit.prevent="saveCategory()">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Назва</label>
                        <input type="text" class="form-input" x-model="form.name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Іконка</label>
                        <select class="form-select" x-model="form.icon">
                            <option value="star">Зірка</option>
                            <option value="coffee">Кава</option>
                            <option value="cup">Напій</option>
                            <option value="sun">Сніданок</option>
                            <option value="sandwich">Сендвіч</option>
                            <option value="leaf">Салат</option>
                            <option value="bowl">Паста</option>
                            <option value="burger">Бургер</option>
                            <option value="pizza">Піца</option>
                            <option value="cake">Десерт</option>
                            <option value="tag">Тег</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Порядок сортування</label>
                        <input type="number" class="form-input" x-model="form.sort_order">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" @click="showModal = false">Скасувати</button>
                    <button type="submit" class="btn btn-primary">Додати</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function categoriesApp() {
    return {
        categories: [],
        showModal: false,
        form: {
            name: '',
            icon: 'tag',
            sort_order: 0
        },

        async loadCategories() {
            try {
                const response = await fetch('/api/categories');
                this.categories = await response.json();
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        },

        openModal() {
            this.form = { name: '', icon: 'tag', sort_order: this.categories.length };
            this.showModal = true;
        },

        async saveCategory() {
            try {
                await fetch('/api/categories', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(this.form)
                });
                this.showModal = false;
                await this.loadCategories();
            } catch (error) {
                console.error('Error saving category:', error);
            }
        },

        async deleteCategory(catId) {
            if (!confirm('Видалити цю категорію?')) return;

            try {
                await fetch(`/api/categories/${catId}`, { method: 'DELETE' });
                await this.loadCategories();
            } catch (error) {
                console.error('Error deleting category:', error);
            }
        },

        getIcon(iconName) {
            const icons = {
                'star': '<svg viewBox="0 0 24 24" width="24" height="24"><path fill="#4CAF50" d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"/></svg>',
                'coffee': '<svg viewBox="0 0 24 24" width="24" height="24"><path fill="#4CAF50" d="M2,21V19H20V21H2M20,8V5H18V8H20M20,3A2,2 0 0,1 22,5V8A2,2 0 0,1 20,10H18V13A4,4 0 0,1 14,17H8A4,4 0 0,1 4,13V3H20M16,5H6V13A2,2 0 0,0 8,15H14A2,2 0 0,0 16,13V5Z"/></svg>',
                'cup': '<svg viewBox="0 0 24 24" width="24" height="24"><path fill="#4CAF50" d="M18.32,8H5.67L5.23,4H18.77M3,2L5,20.23C5.13,21.23 5.97,22 7,22H17C18,22 18.87,21.23 19,20.23L21,2H3Z"/></svg>',
                'sun': '<svg viewBox="0 0 24 24" width="24" height="24"><path fill="#4CAF50" d="M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9"/></svg>',
                'sandwich': '<svg viewBox="0 0 24 24" width="24" height="24"><path fill="#4CAF50" d="M22,15H2C2,16.66 3.34,18 5,18H19C20.66,18 22,16.66 22,15M22,12H2V13H22V12M5,7L2,12H22L19,7H5"/></svg>',
                'leaf': '<svg viewBox="0 0 24 24" width="24" height="24"><path fill="#4CAF50" d="M17,8C8,10 5.9,16.17 3.82,21.34L5.71,22L6.66,19.7C7.14,19.87 7.64,20 8,20C19,20 22,3 22,3C21,5 14,5.25 9,6.25C4,7.25 2,11.5 2,13.5C2,15.5 3.75,17.25 3.75,17.25C7,8 17,8 17,8Z"/></svg>',
                'bowl': '<svg viewBox="0 0 24 24" width="24" height="24"><path fill="#4CAF50" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2"/></svg>',
                'burger': '<svg viewBox="0 0 24 24" width="24" height="24"><path fill="#4CAF50" d="M22,16H2C2,16.91 2.37,17.72 2.97,18.31C3.56,18.89 4.38,19.25 5.29,19.25H18.71C19.62,19.25 20.44,18.89 21.03,18.31C21.63,17.72 22,16.91 22,16M2,14H22"/></svg>',
                'pizza': '<svg viewBox="0 0 24 24" width="24" height="24"><path fill="#4CAF50" d="M12,15A2,2 0 0,1 10,13C10,11.89 10.9,11 12,11A2,2 0 0,1 14,13A2,2 0 0,1 12,15M7,7C7,5.89 7.89,5 9,5A2,2 0 0,1 11,7A2,2 0 0,1 9,9C7.89,9 7,8.1 7,7M12,2C8.43,2 5.23,3.54 3,6L12,22L21,6C18.78,3.54 15.57,2 12,2Z"/></svg>',
                'cake': '<svg viewBox="0 0 24 24" width="24" height="24"><path fill="#4CAF50" d="M12,6C13.11,6 14,5.1 14,4C14,3.62 13.9,3.27 13.71,2.97L12,0L10.29,2.97C10.1,3.27 10,3.62 10,4A2,2 0 0,0 12,6"/></svg>',
                'tag': '<svg viewBox="0 0 24 24" width="24" height="24"><path fill="#4CAF50" d="M5.5,7A1.5,1.5 0 0,1 4,5.5A1.5,1.5 0 0,1 5.5,4A1.5,1.5 0 0,1 7,5.5A1.5,1.5 0 0,1 5.5,7M21.41,11.58L12.41,2.58A2,2 0 0,0 11,2H4A2,2 0 0,0 2,4V11C2,11.55 2.22,12.05 2.59,12.41L11.59,21.41A2,2 0 0,0 13,22A2,2 0 0,0 14.41,21.41L21.41,14.41A2,2 0 0,0 22,13A2,2 0 0,0 21.41,11.58Z"/></svg>'
            };
            return icons[iconName] || icons['tag'];
        }
    };
}
</script>
{% endblock %}
